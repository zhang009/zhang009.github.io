(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{407:function(s,e,r){"use strict";r.r(e);var t=r(4),a=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"常用语句"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用语句"}},[s._v("#")]),s._v(" 常用语句")]),s._v(" "),e("p",[e("strong",[s._v("1、如果有主键或者唯一键冲突则不插入：")]),e("code",[s._v("insert ignore into")])]),s._v(" "),e("p",[e("strong",[s._v("2、如果有主键或者唯一键冲突则更新,注意这个会影响自增的增量：")]),e("code",[s._v('INSERT INTO room_remarks(room_id,room_remarks) VALUE(1,"sdf") ON DUPLICATE KEY UPDATE room_remarks="234"')])]),s._v(" "),e("p",[e("strong",[s._v("3、如果有就用新的替代，values如果不包含自增列，自增列的值会变化：")]),e("code",[s._v('REPLACE INTO room_remarks(room_id,room_remarks) VALUE(1,"sdf")')])]),s._v(" "),e("p",[e("strong",[s._v("4、备份表：")]),e("code",[s._v("CREATE TABLE user_info SELECT * FROM user_info")])]),s._v(" "),e("p",[e("strong",[s._v("5、复制表结构：")]),e("code",[s._v("CREATE TABLE user_v2 LIKE user")])]),s._v(" "),e("p",[e("strong",[s._v("6、从查询语句中导入：")]),e("code",[s._v("INSERT INTO user_v2 SELECT * FROM user或者INSERT INTO user_v2(id,num) SELECT id,num FROM user")])]),s._v(" "),e("p",[e("strong",[s._v("7、连表更新：")]),e("code",[s._v("UPDATE user a, room b SET a.num=a.num+1 WHERE a.room_id=b.id")])]),s._v(" "),e("p",[e("strong",[s._v("8、连表删除：")]),e("code",[s._v("DELETE user FROM user,black WHERE user.id=black.id")])]),s._v(" "),e("h2",{attrs:{id:"锁相关-很少用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#锁相关-很少用"}},[s._v("#")]),s._v(" 锁相关(很少用)")]),s._v(" "),e("p",[e("strong",[s._v("1、共享锁：")]),s._v(" "),e("code",[s._v("select id from tb_test where id = 1 lock in share mode;")])]),s._v(" "),e("p",[e("strong",[s._v("2、排它锁：")]),s._v(" "),e("code",[s._v("select id from tb_test where id = 1 for update")])]),s._v(" "),e("h2",{attrs:{id:"优化时用到"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化时用到"}},[s._v("#")]),s._v(" 优化时用到：")]),s._v(" "),e("p",[e("strong",[s._v("1、强制使用某个索引：")]),s._v(" "),e("code",[s._v("select * from table force index(idx_user) limit 2;")])]),s._v(" "),e("p",[s._v("**2、禁止使用某个索引："),e("code",[s._v("**select * from table ignore index(idx_user) limit 2;")])]),s._v(" "),e("p",[e("strong",[s._v("3、禁用缓存(在测试时去除缓存的影响)：")]),s._v(" "),e("code",[s._v("select SQL_NO_CACHE from table limit 2;")])]),s._v(" "),e("h2",{attrs:{id:"查看状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看状态"}},[s._v("#")]),s._v(" 查看状态")]),s._v(" "),e("p",[s._v("1、查看字符集 "),e("code",[s._v("SHOW VARIABLES LIKE 'character_set%';")])]),s._v(" "),e("p",[s._v("2、查看排序规则 "),e("code",[s._v("SHOW VARIABLES LIKE 'collation%';")])]),s._v(" "),e("h2",{attrs:{id:"慢查询日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志"}},[s._v("#")]),s._v(" 慢查询日志")]),s._v(" "),e("p",[s._v("查询慢查询日志信息可以直接通过执行sql命令查看相关变量，常用的sql如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("-- 查看慢查询配置\n-- slow_query_log  慢查询日志是否开启\n-- slow_query_log_file 的值是记录的慢查询日志到文件中\n-- long_query_time 指定了慢查询的阈值\n-- log_queries_not_using_indexes 是否记录所有没有利用索引的查询\nSHOW VARIABLES LIKE '%quer%';\n\n-- 查看慢查询是日志还是表的形式\nSHOW VARIABLES LIKE 'log_output'\n\n-- 查看慢查询的数量\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("mysqldumpslow的工具十分简单，我主要用到的是参数如下：")]),s._v(" "),e("p",[s._v("例子："),e("code",[s._v("mysqldumpslow -v -s t -t 10 mysql_slow.log.2018-11-20-0500")])]),s._v(" "),e("blockquote",[e("p",[s._v("-t:限制输出的行数，我一般取前十条就够了\n-s:根据什么来排序默认是平均查询时间at，我还经常用到c查询次数，因为查询次数很频繁但是时间不高也是有必要优化的，还有t查询时间，查看那个语句特别卡。\n-v:输出详细信息")])]),s._v(" "),e("h2",{attrs:{id:"查看sql进程和杀死进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看sql进程和杀死进程"}},[s._v("#")]),s._v(" 查看sql进程和杀死进程")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("--查看进程列表\nSHOW PROCESSLIST;\n--杀死某个进程\nkill 183665\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);